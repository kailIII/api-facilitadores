(function(b){var e=function(a,d){var c=this;c.elem=b(a);c.options=b.extend({},b.fn.tagit.defaults,d);c.tagList=b("<ul />");c.tagInput=null;c.availableTags=null;b.when(c.loadAvailableTags()).then(function(){c.buildList();c.bindEvents();c.bindTypeahead();c.tagList=c.elem})};e.prototype={constructor:e,buildList:function(){var a=this;this.elem.find("li").each(function(d,c){a.addTag(b(c).html())});this.addTagInput();this.elem.html("").append(this.tagList.find("li"))},addTag:function(a){if(this.tagExists(a)||
""===a||!this.options.acceptNewTags&&!this.isAvailable(a))return!1;this.options.beforeAdd();var d=b("<i />").addClass("icon-remove").addClass("tagit-btn-remove-tag"),d=b("<a />").html(a).addClass("label label-info").append(d),c=b("<input />").attr("type","hidden").attr("id","tag-"+a).attr("name",this.options.inputName+"[]").val(a);a=b("<li />").data("tag",a).addClass("tagit-item").append(d).append(c);this.tagInput?(a.insertBefore(this.tagInput.parent("li")),this.tagInput.removeClass("error").val("")):
a.appendTo(this.tagList);this.options.afterAdd();return a},tagExists:function(a){var d=this,c=!1;this.tagList.find("li").each(function(e,h){var f=b(h);if((f.data("tag")||f.html()).toLowerCase()==a.toLowerCase())return c=!0,d.tagInput.val(""),d.highlightItem(f),!1});return c},isAvailable:function(a){return 0<=this.availableTags.indexOf(a)},addTagInput:function(){this.tagInput=b("<input />").attr("type","text").attr("class","tagit-input-add-tag").attr("placeholder",this.options.newTagInputText).addClass("input-medium").val("");
this.tagList.append(b("<li />").append(this.tagInput))},bindEvents:function(){var a=this;this.elem.on("keydown",".tagit-input-add-tag",function(d){var c=b(this);if(9==d.keyCode||13==d.keyCode)d.preventDefault(),a.addTag(c.val())||c.addClass("error")});this.elem.on("click",".tagit-btn-remove-tag",function(a){b(this).parents("li.tagit-item").remove();a.preventDefault()})},loadAvailableTags:function(){var a=this;if("string"===b.type(this.options.tagSource))return b.getJSON(this.options.tagSource,function(b){a.availableTags=
b});this.availableTags=this.options.tagSource;return!0},highlightItem:function(a){a.find("a").css("background-color","#BD362F");setTimeout(function(){a.find("a").attr("style","")},1300)},bindTypeahead:function(){var a=this;a.tagInput.typeahead({source:a.availableTags,minLength:a.options.minCharSuggestion,afterSelect:function(b){a.addTag(b)}})}};b.fn.tagit=function(a){return this.each(function(){var d=b(this),c=d.data("tagit"),g="object"==typeof a&&a;c||d.data("tagit",c=new e(this,g));if("string"==
typeof a)c[a]()})};b.fn.tagit.defaults={inputName:"tags",tagSource:null,newTagInputText:"new tag",minCharSuggestion:1,acceptNewTags:!0,afterAdd:function(){},beforeAdd:function(){}};b.fn.tagit.Constructor=e})(jQuery);